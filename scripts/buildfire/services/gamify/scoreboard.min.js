if("undefined"==typeof buildfire)throw"please add buildfire.js first to use BuildFire services";buildfire.gamify||(buildfire.gamify={}),buildfire.gamify.Scoreboard=function(e,i,t){this.size=i||10,this.autoSubscribeToPushNotification=t,this.size<1&&(this.size=10),this.tagName=e||"scoreboard",this.pushGroupName="scoreboard_"+this.tagName},buildfire.gamify.Scoreboard.prototype={size:10,getScoreboard:function(e){buildfire.publicData.get(this.tagName,function(i,t){i?e(i):t.data.topScores?e(void 0,t.data):e(void 0,{gamesPlayed:0,topScores:[]})})},reset:function(){var e={gamesPlayed:0,topScores:[]};buildfire.publicData.save(e,this.tagName,function(){})},_PNEnabled:function(){return buildfire.notifications&&buildfire.notifications.pushNotification},subscribe:function(e){return!!this._PNEnabled()&&(buildfire.notifications.pushNotification.subscribe({groupName:this.pushGroupName},function(i){i&&console.error(i),e&&e(i)}),!0)},unsubscribe:function(e){return!!this._PNEnabled()&&(buildfire.notifications.pushNotification.unsubscribe({groupName:this.pushGroupName},function(i){i&&console.error(i),e&&e(i)}),!0)},logScore:function(e,i,t){this.autoSubscribeToPushNotification&&(this.subscribe()||console.warn("Cannot subscribe to scoreboard push notifications because buildfire push notification services is not attached"));var o=this,a=new Date;buildfire.publicData.get(this.tagName,function(s,r){function u(e){e&&t(e)}var n={user:e,score:i,createdOn:a},c={gamesPlayed:0,topScores:[n]};if(s)t(s);else if(r)if(r.data.topScores){r.data.topScores.length>o.size&&r.data.topScores[o.size-1].score>i&&t(),(c=r.data).topScores.push(n),c.topScores=c.topScores.sort(function(e,i){return i.score-e.score});var d;c.topScores.length>o.size&&(d=c.topScores.pop()),c.gamesPlayed++,buildfire.publicData.update(r.id,c,o.tagName,u);for(var f,l=0;l<c.topScores.length;l++)if(c.topScores[l].createdOn==a){f=l;break}var p={bumpedOff:d,rankedAt:f};o._PNEnabled()&&(p.bumpedOff&&p.bumpedOff.user.email!=e.email&&buildfire.notifications.pushNotification.schedule({title:"You got kicked off !!!",text:"Your old score is no longer on the top 10. "+e.displayName+" has taken your spot. Honestly, I dont know how you sleep at night.",users:[p.bumpedOff.user.id]},u),0==f&&buildfire.notifications.pushNotification.schedule({title:"There is a new champion!",text:e.displayName+" has taken the lead at the new undisputed champion with a score of "+i,groupName:o.pushGroupName},u),1==f&&buildfire.notifications.pushNotification.schedule({title:"There is a challenger to the champion",text:e.displayName+" has taken 2nd place with a score of "+i+". Watch out "+c.topScores[0].user.displayName,groupName:o.pushGroupName},u),2==f&&buildfire.notifications.pushNotification.schedule({title:"There is a kid in town!",text:e.displayName+" has taken 3rd place. Keep an eye on this one",groupName:o.pushGroupName},u)),t(null,p)}else c.gamesPlayed++,buildfire.publicData.save(c,o.tagName,u);else c.gamesPlayed++,buildfire.publicData.save(c,o.tagName,u),t(null,{rankedAt:0})})}};
//# sourceMappingURL=scoreboard.min.js.map
